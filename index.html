<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deutsch interaktiv Studio FINAL PRO</title>
    <style>
        :root { --primary: #6c5ce7; --bg: #0f2027; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; min-height: 100vh; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); color: #2d3436; overflow-x: hidden; }
        
        /* –£–±–∏—Ä–∞–µ–º –±–æ–∫–∞ - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .container { display: grid; grid-template-columns: 350px 1fr; gap: 0; width: 100vw; height: 100vh; }
        
        .panel { background: rgba(255, 255, 255, 0.98); padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; border-right: 1px solid #ddd; overflow-y: auto; }
        .player-panel { background: #fff; padding: 20px; display: flex; flex-direction: column; align-items: center; position: relative; overflow-y: auto; }
        
        .header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; width: 100%; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .logo { width: 50px; height: 50px; border-radius: 50%; object-fit: contain; background: #fff; border: 1px solid #eee; }
        
        .cover-art { width: 100%; max-width: 450px; height: 280px; border-radius: 20px; background: #f0f0f0 center/cover no-repeat; border: 5px solid #fff; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; position: relative; }
        .cover-art::after { content: "üéµ"; font-size: 80px; opacity: 0.1; position: absolute; }
        .has-img::after { display: none; }

        label { display: block; font-size: 0.7rem; font-weight: bold; margin: 10px 0 4px; text-transform: uppercase; color: #666; width: 100%; }
        .hint { font-size: 0.65rem; color: #888; margin-top: -2px; margin-bottom: 8px; line-height: 1.2; font-style: italic; }
        
        select, input, textarea { width: 100%; padding: 9px; border-radius: 10px; border: 1px solid #ccc; margin-bottom: 8px; font-size: 0.85rem; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 12px; background: var(--primary); color: white; cursor: pointer; font-weight: bold; margin-top: 8px; font-size: 0.9rem; transition: 0.3s; }
        .btn:hover { filter: brightness(1.1); }

        .controls { display: flex; gap: 15px; margin: 15px 0; align-items: center; }
        .c-btn { width: 50px; height: 50px; border-radius: 50%; border: none; background: var(--primary); color: white; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .c-btn:disabled { background: #ccc !important; cursor: not-allowed; }
        #play { width: 70px; height: 70px; font-size: 2rem; }

        #lock-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; padding: 20px; }
        #attempt-msg { font-weight: bold; color: #e74c3c; margin-bottom: 5px; font-size: 1rem; min-height: 1.2rem; }

        @media (max-width: 800px) { .container { grid-template-columns: 1fr; } .panel { height: auto; } }
    </style>
</head>
<body>

<div id="lock-screen">
    <h1 id="lock-title">Time is up</h1>
    <p id="lock-desc">–≠–∫–∑–∞–º–µ–Ω –æ–∫–æ–Ω—á–µ–Ω. –î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç.</p>
    <button class="btn" onclick="location.reload()" style="width:180px; background:#e74c3c">Restart / –°–±—Ä–æ—Å</button>
</div>

<div class="container">
    <div class="panel">
        <div class="header">
            <img src="logo.png" class="logo" alt="Logo" onerror="this.src='https://via.placeholder.com/50?text=DI'">
            <h3 style="margin:0">Audio Editor</h3>
        </div>
        
        <label>üåê –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
        <select id="langSet">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option><option value="de">Deutsch</option><option value="en">English</option>
            <option value="fr">Fran√ßais</option><option value="it">Italiano</option><option value="es">Espa√±ol</option>
            <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option><option value="pl">Polski</option><option value="tr">T√ºrk√ße</option>
            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option><option value="zh">‰∏≠Êñá</option><option value="ja">Êó•Êú¨Ë™û</option>
            <option value="ko">ÌïúÍµ≠Ïñ¥</option><option value="pt">Portugu√™s</option><option value="nl">Nederlands</option>
            <option value="sv">Svenska</option><option value="no">Norsk</option><option value="fi">Suomi</option>
            <option value="da">Dansk</option><option value="cs">ƒåe≈°tina</option><option value="hu">Magyar</option>
        </select>

        <label>üéì –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</label>
        <select id="modeSet">
            <option value="master">Master Mode (Loop)</option>
            <option value="study">Study Mode (2 Attempts / Slow)</option>
            <option value="test">Test Mode (Exam / 2 Attempts)</option>
        </select>

        <button class="btn" id="slowBtn" style="background:#00b894; display:none">üê¢ Slow Motion (0.8x)</button>
        <button class="btn" id="loopBtn" style="background:#0984e3; display:none">üîÑ Loop: Off</button>

        <label style="margin-top:20px">üì¶ –ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ (Genially)</label>
        <textarea id="ifOut" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–¥..."></textarea>
        <button class="btn" id="copyBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
    </div>

    <div class="player-panel">
        <div id="attempt-msg"></div>
        <div class="cover-art" id="cover"></div>
        
        <input type="range" id="prog" value="0" step="0.1" style="width:100%; max-width:600px; margin-top:25px; accent-color:var(--primary);">
        <div id="time-txt" style="font-weight:bold; margin: 8px 0; font-family: monospace;">00:00 / 00:00</div>

        <div class="controls">
            <button class="c-btn" id="rew">‚è™</button>
            <button class="c-btn" id="play">‚ñ∂</button>
            <button class="c-btn" id="fwd">‚è©</button>
        </div>

        <div style="width:100%; max-width:500px;">
            <label>üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –ê—É–¥–∏–æ (URL)</label>
            <div class="hint">–°–æ–≤–µ—Ç: –ü—Ä. –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏ –Ω–∞ ¬´–°–∫–∞—á–∞—Ç—å¬ª ‚Üí –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å —Å—Å—ã–ª–∫–∏</div>
            <input type="text" id="audUrl" placeholder="https://example.com/audio.mp3">
            
            <label>üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –û–±–ª–æ–∂–∫—É (URL)</label>
            <input type="text" id="imgUrl" placeholder="https://example.com/image.jpg">
            
            <label>üìÅ –ò–ª–∏ —Ñ–∞–π–ª –∞—É–¥–∏–æ</label>
            <input type="file" id="audIn" accept="audio/*">
            
            <label>üñºÔ∏è –ò–ª–∏ —Ñ–∞–π–ª –æ–±–ª–æ–∂–∫–∏</label>
            <input type="file" id="imgIn" accept="image/*">
        </div>
    </div>
</div>

<script>
    const audio = new Audio();
    audio.preservesPitch = true;
    let plays = 0;

    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ URL –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    document.getElementById('audUrl').addEventListener('input', function() {
        if(this.value.trim()) { audio.src = this.value.trim(); plays = 0; }
    });

    document.getElementById('imgUrl').addEventListener('input', function() {
        if(this.value.trim()) {
            const cov = document.getElementById('cover');
            cov.style.backgroundImage = `url(${this.value.trim()})`;
            cov.classList.add('has-img');
        }
    });

    // –§–∞–π–ª–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    document.getElementById('audIn').onchange = (e) => { 
        if(e.target.files[0]) { audio.src = URL.createObjectURL(e.target.files[0]); plays = 0; }
    };
    document.getElementById('imgIn').onchange = (e) => {
        if(e.target.files[0]) {
            const url = URL.createObjectURL(e.target.files[0]);
            const cov = document.getElementById('cover');
            cov.style.backgroundImage = `url(${url})`;
            cov.classList.add('has-img');
        }
    };

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
    document.getElementById('modeSet').onchange = function() {
        const m = this.value;
        plays = 0;
        audio.loop = false;
        audio.playbackRate = 1;
        document.getElementById('slowBtn').style.display = (m==='study') ? 'block' : 'none';
        document.getElementById('loopBtn').style.display = (m==='master') ? 'block' : 'none';
        document.getElementById('attempt-msg').innerText = "";
        
        // –í Test Mode –±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–æ—Ç–∫—É –°–†–ê–ó–£
        const isTest = (m === 'test');
        document.getElementById('prog').style.pointerEvents = isTest ? 'none' : 'auto';
        document.getElementById('rew').disabled = isTest;
        document.getElementById('fwd').disabled = isTest;
    };

    document.getElementById('play').onclick = () => {
        if(!audio.src) return alert("–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ!");
        if(audio.paused) {
            audio.play();
            document.getElementById('play').innerText = '‚è∏';
        } else {
            audio.pause();
            document.getElementById('play').innerText = '‚ñ∂';
        }
    };

    audio.onplay = () => {
        const m = document.getElementById('modeSet').value;
        if(m === 'study' || m === 'test') {
            // –°—á–∏—Ç–∞–µ–º –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
            if(audio.currentTime === 0) plays++;
            
            if(m === 'test') document.getElementById('attempt-msg').innerText = "–ü–æ–ø—ã—Ç–∫–∞: " + plays + " / 2";
            
            // –í Study Mode –±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–æ—Ç–∫—É –Ω–∞ 3-–π –ø–æ–ø—ã—Ç–∫–µ
            if(m === 'study' && plays >= 3) {
                document.getElementById('prog').style.pointerEvents = 'none';
                document.getElementById('rew').disabled = true;
                document.getElementById('fwd').disabled = true;
            }

            // –í Test Mode –±–ª–æ–∫–∏—Ä—É–µ–º –≤—Å—ë –ø–æ—Å–ª–µ 2-—Ö –ø–æ–ª–Ω—ã—Ö –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π
            if(m === 'test' && plays > 2) {
                audio.pause();
                document.getElementById('lock-screen').style.display = 'flex';
            }
        }
    };

    audio.onended = () => {
        document.getElementById('play').innerText = '‚ñ∂';
        const m = document.getElementById('modeSet').value;
        if(m === 'test' && plays >= 2) {
            document.getElementById('lock-screen').style.display = 'flex';
        }
    };

    document.getElementById('slowBtn').onclick = () => {
        audio.playbackRate = (audio.playbackRate === 1) ? 0.8 : 1;
        document.getElementById('slowBtn').style.background = (audio.playbackRate === 0.8) ? "#e67e22" : "#00b894";
    };

    document.getElementById('loopBtn').onclick = () => {
        audio.loop = !audio.loop;
        document.getElementById('loopBtn').innerText = audio.loop ? "üîÑ Loop: ON" : "üîÑ Loop: OFF";
    };

    audio.ontimeupdate = () => {
        const p = document.getElementById('prog');
        p.max = audio.duration || 0;
        p.value = audio.currentTime;
        const fmt = s => new Date(s * 1000).toISOString().substr(14, 5);
        document.getElementById('time-txt').innerText = fmt(audio.currentTime) + " / " + fmt(audio.duration || 0);
    };

    document.getElementById('prog').oninput = (e) => audio.currentTime = e.target.value;
    document.getElementById('rew').onclick = () => audio.currentTime -= 10;
    document.getElementById('fwd').onclick = () => audio.currentTime += 10;

    document.getElementById('copyBtn').onclick = () => {
        const code = `<iframe src="${window.location.href}" width="100%" height="600px" frameborder="0" scrolling="no"></iframe>`;
        document.getElementById('ifOut').value = code;
        navigator.clipboard.writeText(code);
        alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –¥–ª—è Genially!");
    };
</script>
</body>
</html>
