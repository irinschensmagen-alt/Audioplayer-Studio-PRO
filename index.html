<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Studio EDU Pro</title>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --bg-gradient: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
            --panel-bg: #ffffff;
            --accent-bg: #fafafa;
            --text-main: #333;
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        body.dark-mode {
            --bg-gradient: linear-gradient(135deg, #2d3436 0%, #000000 100%);
            --panel-bg: #1e1e1e;
            --accent-bg: #2d2d2d;
            --text-main: #f0f0f0;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: 0.3s;
        }

        .container {
            display: grid;
            grid-template-columns: 350px 500px;
            gap: 25px;
            padding: 20px;
        }

        .panel {
            background: var(--panel-bg);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h2 { font-size: 1.2rem; margin-top: 0; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; font-weight: 600; }
        
        select, input[type="file"], input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: var(--accent-bg);
            color: var(--text-main);
            font-size: 0.85rem;
            box-sizing: border-box;
        }

        .btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: none;
            border-radius: 10px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: 0.2s ease;
        }

        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }
        .btn.recording { background: #ff4757; animation: pulse 1.5s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .player-display { display: flex; flex-direction: column; align-items: center; }
        
        .cover-art {
            width: 100%;
            height: 250px;
            background: #eee url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?q=80&w=500&auto=format') center/cover;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 5px solid var(--panel-bg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        canvas {
            width: 100%;
            height: 70px;
            background: var(--accent-bg);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .controls { display: flex; gap: 20px; margin-bottom: 15px; }
        .control-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(108, 92, 231, 0.4);
        }

        .progress-box { width: 100%; text-align: center; }
        input[type="range"] { width: 100%; accent-color: var(--primary-color); cursor: pointer; }
        .time-display { font-size: 0.9rem; color: var(--text-main); margin-bottom: 5px; font-family: 'Courier New', monospace; }

        .download-link {
            text-align: center;
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: bold;
            display: none;
            padding: 10px;
            border: 2px dashed var(--primary-color);
            border-radius: 10px;
            margin-top: 10px;
        }

        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h2 id="ui-title">üì± Audio Studio EDU</h2>
        
        <div class="form-group">
            <label id="lbl-lang">üåê –í—ã–±–æ—Ä —è–∑—ã–∫–∞</label>
            <select id="langSelect">
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="en">English</option>
                <option value="zh">‰∏≠Êñá</option>
            </select>
        </div>

        <div class="form-group">
            <label id="lbl-cover-file">üñºÔ∏è –û–±–ª–æ–∂–∫–∞ (–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª)</label>
            <input type="file" id="coverUpload" accept="image/*">
        </div>

        <div class="form-group">
            <label id="lbl-cover-url">üîó –û–±–ª–æ–∂–∫–∞ (–°—Å—ã–ª–∫–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)</label>
            <div style="display:flex; gap:5px;">
                <input type="text" id="coverUrl" placeholder="https://...">
                <button class="btn" id="applyCoverUrl" style="margin:0; width:60px;">OK</button>
            </div>
        </div>

        <div class="form-group">
            <label id="lbl-audio">üéµ –ê—É–¥–∏–æ—Ñ–∞–π–ª</label>
            <input type="file" id="audioUpload" accept="audio/*">
        </div>

        <button class="btn" id="recordBtn"><span id="btn-rec-text">üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞</span></button>
        
        <div style="margin-top:20px; display:flex; flex-direction:column; gap:8px;">
            <a id="downloadLink" class="download-link" download="my_audio.webm">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</a>
            <button class="btn" id="iframeBtn" style="background: #a29bfe;"><span id="btn-iframe-text">üì¶ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ iframe</span></button>
            <button class="btn" id="themeBtn" style="background: #444;"><span id="btn-theme-text">üåì –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</span></button>
        </div>
    </div>

    <div class="panel player-display">
        <div class="cover-art" id="coverArt"></div>
        <canvas id="visualizer"></canvas>
        
        <div class="progress-box">
            <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
            <input type="range" id="progressBar" value="0" min="0" step="0.1">
        </div>

        <div class="controls">
            <button class="control-btn" id="rewindBtn">‚è™</button>
            <button class="control-btn" id="playBtn">‚ñ∂</button>
            <button class="control-btn" id="forwardBtn">‚è©</button>
        </div>

        <button class="btn" style="background: #8e8e93; margin-top: 15px;"><span id="btn-playlist-text">üìÇ –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</span></button>
        <audio id="mainAudio" crossorigin="anonymous"></audio>
    </div>
</div>

<script>
    const translations = {
        ru: {
            title: "üì± Audio Studio EDU", lblLang: "üåê –í—ã–±–æ—Ä —è–∑—ã–∫–∞", lblCoverFile: "üñºÔ∏è –û–±–ª–æ–∂–∫–∞ (–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª)",
            lblCoverUrl: "üîó –û–±–ª–æ–∂–∫–∞ (–°—Å—ã–ª–∫–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)", lblAudio: "üéµ –ê—É–¥–∏–æ—Ñ–∞–π–ª", btnRecStart: "üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞",
            btnRecStop: "‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å", btnIframe: "üì¶ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ iframe", btnTheme: "üåì –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É",
            btnPlaylist: "üìÇ –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç", download: "‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ–∑–∞–ø–∏—Å—å", copyAlert: "–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!"
        },
        en: {
            title: "üì± Audio Studio EDU", lblLang: "üåê Select Language", lblCoverFile: "üñºÔ∏è Cover (Upload File)",
            lblCoverUrl: "üîó Cover (Web Link)", lblAudio: "üéµ Audio File", btnRecStart: "üé§ Start Recording",
            btnRecStop: "‚èπ Stop Recording", btnIframe: "üì¶ Copy iframe Code", btnTheme: "üåì Toggle Theme",
            btnPlaylist: "üìÇ Show Playlist", download: "‚¨áÔ∏è Download Audio", copyAlert: "Code copied!"
        },
        zh: {
            title: "üì± Èü≥È¢ëÂ∑•‰ΩúÂÆ§ EDU", lblLang: "üåê ÈÄâÊã©ËØ≠Ë®Ä", lblCoverFile: "üñºÔ∏è Â∞ÅÈù¢ (‰∏ä‰º†Êñá‰ª∂)",
            lblCoverUrl: "üîó Â∞ÅÈù¢ (ÁΩëÈ°µÈìæÊé•)", lblAudio: "üéµ Èü≥È¢ëÊñá‰ª∂", btnRecStart: "üé§ ÂºÄÂßãÂΩïÈü≥",
            btnRecStop: "‚èπ ÂÅúÊ≠¢ÂΩïÈü≥", btnIframe: "üì¶ Â§çÂà∂ iframe ‰ª£Á†Å", btnTheme: "üåì ÂàáÊç¢‰∏ªÈ¢ò",
            btnPlaylist: "üìÇ ÊòæÁ§∫Êí≠ÊîæÂàóË°®", download: "‚¨áÔ∏è ‰∏ãËΩΩÂΩïÈü≥", copyAlert: "‰ª£Á†ÅÂ∑≤Â§çÂà∂!"
        }
    };

    const audio = document.getElementById('mainAudio');
    const playBtn = document.getElementById('playBtn');
    const recordBtn = document.getElementById('recordBtn');
    const langSelect = document.getElementById('langSelect');
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');

    let audioContext, analyser, source;
    let mediaRecorder, audioChunks = [];

    // --- –õ–û–ö–ê–õ–ò–ó–ê–¶–ò–Ø ---
    function updateLanguage() {
        const t = translations[langSelect.value];
        document.getElementById('ui-title').innerText = t.title;
        document.getElementById('lbl-lang').innerText = t.lblLang;
        document.getElementById('lbl-cover-file').innerText = t.lblCoverFile;
        document.getElementById('lbl-cover-url').innerText = t.lblCoverUrl;
        document.getElementById('lbl-audio').innerText = t.lblAudio;
        document.getElementById('btn-rec-text').innerText = (mediaRecorder?.state === "recording") ? t.btnRecStop : t.btnRecStart;
        document.getElementById('btn-iframe-text').innerText = t.btnIframe;
        document.getElementById('btn-theme-text').innerText = t.btnTheme;
        document.getElementById('btn-playlist-text').innerText = t.btnPlaylist;
        document.getElementById('downloadLink').innerText = t.download;
    }
    langSelect.onchange = updateLanguage;

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ê–£–î–ò–û (–í–ê–ñ–ù–û –î–õ–Ø –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø) ---
    function resumeAudioContext() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            source = audioContext.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            drawVisualizer();
        }
        if (audioContext.state === 'suspended') audioContext.resume();
    }

    // --- –ü–õ–ï–ï–† ---
    playBtn.onclick = () => {
        if (!audio.src) return;
        resumeAudioContext();
        if (audio.paused) {
            audio.play().then(() => playBtn.innerText = '‚è∏').catch(e => console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", e));
        } else {
            audio.pause();
            playBtn.innerText = '‚ñ∂';
        }
    };

    document.getElementById('audioUpload').onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
            audio.src = URL.createObjectURL(file);
            audio.load(); // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            document.getElementById('downloadLink').style.display = "block";
            document.getElementById('downloadLink').href = audio.src;
        }
    };

    // --- –û–ë–õ–û–ñ–ö–ê ---
    document.getElementById('coverUpload').onchange = (e) => {
        if (e.target.files[0]) document.getElementById('coverArt').style.backgroundImage = `url(${URL.createObjectURL(e.target.files[0])})`;
    };
    document.getElementById('applyCoverUrl').onclick = () => {
        const url = document.getElementById('coverUrl').value;
        if (url) document.getElementById('coverArt').style.backgroundImage = `url('${url}')`;
    };

    // --- –¢–ï–ú–ê ---
    document.getElementById('themeBtn').onclick = () => document.body.classList.toggle('dark-mode');

    // --- –í–ò–ó–£–ê–õ–ò–ó–ê–¢–û–† ---
    function drawVisualizer() {
        requestAnimationFrame(drawVisualizer);
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        analyser.getByteFrequencyData(dataArray);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#6c5ce7';
        for (let i = 0; i < 80; i++) {
            const barHeight = dataArray[i] / 4;
            ctx.fillRect(i * 4, canvas.height - barHeight, 3, barHeight);
        }
    }

    // --- –ó–ê–ü–ò–°–¨ ---
    recordBtn.onclick = async () => {
        if (mediaRecorder && mediaRecorder.state === "recording") {
            mediaRecorder.stop();
            recordBtn.classList.remove('recording');
        } else {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(audioChunks, { type: 'audio/webm' });
                    audio.src = URL.createObjectURL(blob);
                    document.getElementById('downloadLink').style.display = "block";
                    document.getElementById('downloadLink').href = audio.src;
                    updateLanguage();
                };
                mediaRecorder.start();
                recordBtn.classList.add('recording');
                updateLanguage();
            } catch (err) { alert("–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!"); }
        }
    };

    // –¢–∞–π–º–µ—Ä –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
    audio.ontimeupdate = () => {
        document.getElementById('progressBar').max = audio.duration || 0;
        document.getElementById('progressBar').value = audio.currentTime;
        const format = s => new Date(s * 1000).toISOString().substr(14, 5);
        document.getElementById('timeDisplay').innerText = `${format(audio.currentTime)} / ${format(audio.duration || 0)}`;
    };
    document.getElementById('progressBar').oninput = (e) => audio.currentTime = e.target.value;
    document.getElementById('rewindBtn').onclick = () => audio.currentTime -= 10;
    document.getElementById('forwardBtn').onclick = () => audio.currentTime += 10;

    document.getElementById('iframeBtn').onclick = () => {
        navigator.clipboard.writeText(`<iframe src="${window.location.href}" width="100%" height="700px" frameborder="0"></iframe>`);
        alert(translations[langSelect.value].copyAlert);
    };

    updateLanguage();
</script>
</body>
</html>
