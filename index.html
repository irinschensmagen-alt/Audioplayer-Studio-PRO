<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Studio Pro: Master Edition</title>
    <style>
        :root { 
            --gold: linear-gradient(135deg, #d4af37, #f1c40f, #c5a028);
            --gold-text: #b8860b;
            --danger: #e74c3c;
            --success: #27ae60;
        }

        @keyframes chameleon {
            0% { background-color: #f3e5f5; }
            100% { background-color: #e3f2fd; }
        }

        body { 
            font-family: 'Segoe UI', sans-serif; margin: 0; 
            animation: chameleon 30s infinite alternate;
            color: #444; display: flex; height: 100vh; overflow: hidden; 
        }

        /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ | –ü–ª–µ–µ—Ä | –û–≥—Ä–æ–º–Ω—ã–π PDF */
        .container { 
            display: grid; 
            grid-template-columns: 280px 420px 1fr; 
            width: 100%; 
            height: 100vh;
            transition: 0.5s;
        }
        
        .container.test-mode { grid-template-columns: 280px 1fr 0px; }

        .settings { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 15px; 
            border-right: 1px solid rgba(0,0,0,0.1); 
            overflow-y: auto; 
            backdrop-filter: blur(10px);
        }
        .header { display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f1c40f; padding-bottom: 10px; margin-bottom: 15px; }
        .logo-img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #d4af37; }

        .player-view { 
            background: rgba(255, 255, 255, 0.4);
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            overflow-y: auto;
            border-right: 1px solid rgba(0,0,0,0.05);
        }
        
        .cover { 
            width: 100%; height: 200px; border-radius: 15px; 
            background: #fff center/cover no-repeat; border: 4px solid white; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center;
        }
        .cover:not(.has-img)::after { content: "üéµ"; font-size: 50px; opacity: 0.2; }

        /* –û–∫–Ω–æ —Å–ª–æ–≤–∞—Ä—è —Ç–µ–ø–µ—Ä—å –∑–∞–Ω–∏–º–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º –º–µ—Å—Ç–∞ */
        .materials-view { 
            background: #525659; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }
        .viewer-header { 
            background: #323639; color: white; padding: 10px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.85rem; font-weight: bold;
        }

        label { display: block; font-size: 0.65rem; font-weight: 800; margin-top: 10px; color: var(--gold-text); text-transform: uppercase; }
        select, input, textarea { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ccc; margin-top: 4px; font-size: 0.8rem; }
        .btn { width: 100%; padding: 10px; border: none; border-radius: 10px; background: var(--gold); color: white; font-weight: bold; cursor: pointer; margin-top: 8px; }
        
        .controls { display: flex; gap: 15px; align-items: center; margin: 10px 0; }
        .c-btn { width: 45px; height: 45px; border-radius: 12px; border: none; background: white; color: #d4af37; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        #play-btn { width: 60px; height: 60px; border-radius: 50%; background: var(--gold); color: white; font-size: 1.5rem; }

        #prog { width: 100%; accent-color: #d4af37; cursor: pointer; }
        .card { background: white; padding: 12px; border-radius: 12px; margin-top: 8px; width: 100%; border: 1px solid #eee; box-sizing: border-box; }

        #doc-frame { width: 100%; height: 100%; border: none; }
        #lock-screen { position: absolute; inset: 0; background: white; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="lock-screen">
    <h1 style="color:var(--danger); font-size: 3rem;">TIME IS UP</h1>
    <button class="btn" style="width:200px" onclick="location.reload()">RESTART</button>
</div>

<div class="container" id="main-container">
    <div class="settings">
        <div class="header">
            <img src="https://irinschensmagen-alt.github.io/Audioplayer-Studio-Pro/logo.png" class="logo-img">
            <h3 id="ui-title" style="font-size: 0.9rem;">Audio Studio Pro</h3>
        </div>

        <label>Language / –Ø–∑—ã–∫</label>
        <select id="langSelect">
            <option value="ru" selected>–†—É—Å—Å–∫–∏–π</option><option value="en">English</option><option value="de">Deutsch</option>
            <option value="da">ÿØÿ±€å</option><option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option><option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
        </select>

        <label>Mode / –†–µ–∂–∏–º</label>
        <select id="modeSelect" onchange="applyMode()">
            <option value="master">Master (Loop)</option>
            <option value="study" selected>Study (–£—á–µ–Ω–∏–∫)</option>
            <option value="test">Test (Exam)</option>
        </select>

        <button class="btn" id="slowBtn" style="background:#27ae60" onclick="toggleSlow()">üê¢ SLOW 0.8x</button>

        <label>Upload Dictionary (PDF)</label>
        <input type="file" id="docFile" accept=".pdf">
        
        <label>Web Dictionary URL</label>
        <div style="display:flex; gap:5px;">
            <input type="text" id="dictUrl" placeholder="https://...">
            <button class="c-btn" style="width:40px; height:35px; margin-top:4px;" onclick="openExternalDict()">‚Üó</button>
        </div>

        <label>Embed Code</label>
        <textarea id="code-out" rows="2" readonly></textarea>
        <button class="btn" onclick="copyCode()">Copy Code</button>
    </div>

    <div class="player-view">
        <div id="status-display" style="font-weight:bold; color:red; margin-bottom:5px; height:20px;"></div>
        <div class="cover" id="cover-div"></div>
        <input type="range" id="prog" value="0" step="0.1" oninput="audio.currentTime=this.value">
        <div id="time-txt" style="font-weight:bold; margin:10px;">00:00 / 00:00</div>
        
        <div class="controls">
            <button class="c-btn" onclick="audio.currentTime-=10">‚è™</button>
            <button class="c-btn" id="play-btn" onclick="togglePlay()">‚ñ∂</button>
            <button class="c-btn" onclick="audio.currentTime+=10">‚è©</button>
        </div>

        <div class="card">
            <label>Audio Source (URL & PC)</label>
            <input type="text" id="audUrl" placeholder="Paste Audio URL..." oninput="audio.src=this.value">
            <input type="file" id="audFile" accept="audio/*" onchange="audio.src=URL.createObjectURL(this.files[0])">
        </div>

        <div class="card">
            <label>Cover Image (URL & PC)</label>
            <input type="text" id="imgUrl" placeholder="Paste Image URL..." oninput="loadImg(this.value)">
            <input type="file" id="imgFile" accept="image/*" onchange="loadImg(this)">
        </div>
    </div>

    <div class="materials-view" id="mat-panel">
        <div class="viewer-header">
            <span>DICTIONARY & MATERIALS</span>
            <span style="font-weight:normal; font-size:0.7rem;">Audio Studio Pro Viewer</span>
        </div>
        <iframe id="doc-frame" src="about:blank"></iframe>
        <div id="hint-msg" style="padding:40px; text-align:center; color:#ccc;">
            –ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–ª–æ–≤–∞—Ä—å.
        </div>
    </div>
</div>

<script>
    const audio = new Audio();
    let plays = 0;

    function loadImg(source) {
        const div = document.getElementById('cover-div');
        let url = (source.files) ? URL.createObjectURL(source.files[0]) : source;
        div.style.backgroundImage = `url(${url})`;
        div.classList.add('has-img');
    }

    document.getElementById('docFile').onchange = function(e) {
        if(this.files[0]) {
            const url = URL.createObjectURL(this.files[0]);
            document.getElementById('doc-frame').src = url + "#view=FitH";
            document.getElementById('hint-msg').style.display = 'none';
        }
    };

    document.getElementById('dictUrl').oninput = function() {
        document.getElementById('doc-frame').src = this.value;
        document.getElementById('hint-msg').style.display = this.value ? 'none' : 'block';
    };

    function openExternalDict() {
        const url = document.getElementById('dictUrl').value;
        if(url) window.open(url, '_blank', 'width=900,height=1000');
    }

    function applyMode() {
        const m = document.getElementById('modeSelect').value;
        const container = document.getElementById('main-container');
        if(m === 'test') container.classList.add('test-mode');
        else container.classList.remove('test-mode');
        document.getElementById('slowBtn').style.display = (m === 'study') ? 'block' : 'none';
        plays = 0; updateStatus();
    }

    function togglePlay() { if(audio.src) audio.paused ? audio.play() : audio.pause(); }
    function toggleSlow() {
        audio.playbackRate = (audio.playbackRate === 1) ? 0.8 : 1;
        document.getElementById('slowBtn').style.background = (audio.playbackRate === 0.8) ? "#e67e22" : "#27ae60";
    }

    audio.onplay = () => {
        if(document.getElementById('modeSelect').value === 'test' && audio.currentTime === 0) {
            plays++; updateStatus();
            if(plays > 2) { audio.pause(); document.getElementById('lock-screen').style.display = 'flex'; }
        }
        document.getElementById('play-btn').innerText = '‚è∏';
    };
    audio.onpause = () => document.getElementById('play-btn').innerText = '‚ñ∂';
    
    audio.ontimeupdate = () => {
        const p = document.getElementById('prog');
        p.max = audio.duration || 0; p.value = audio.currentTime;
        const f = s => new Date(s * 1000).toISOString().substr(14, 5);
        document.getElementById('time-txt').innerText = `${f(audio.currentTime)} / ${f(audio.duration || 0)}`;
    };

    function updateStatus() {
        const m = document.getElementById('modeSelect').value;
        document.getElementById('status-display').innerText = (m === 'test') ? `Attempt: ${plays + 1} / 2` : "";
    }

    function copyCode() {
        const code = `<iframe src="${window.location.href}" width="100%" height="800" frameborder="0"></iframe>`;
        navigator.clipboard.writeText(code); alert("Code Copied!");
    }

    applyMode();
</script>
</body>
</html>
